Attribute VB_Name = "eq_anfis"
Function fminmax(x, xmin, xmax)
    fminmax = WorksheetFunction.Min(WorksheetFunction.max(x, xmin), xmax)
End Function

Function anfis_x_b3_all(xx1, xx2, xx3, xx4, xx5, xx6, xx7, case_)

    If case_ = 2 Then
        x1 = fminmax(xx1, 0.248668898615326, 0.59769387755102): x2 = fminmax(xx2, 0, 0): x3 = fminmax(xx3, 0.01, 0.986838420610473): x4 = fminmax(xx4, 1, 1): x5 = fminmax(xx5, 1.31615793895268E-02, 0.99): x6 = fminmax(xx6, 0.47244094488189, 1.5): x7 = fminmax(xx7, 0, 0):
        z = anfis_case2(x1, x2, x3, x4, x5, x6, x7)
        z = fminmax(z, 0.441929789124045, 1.18845467109234)
    ElseIf case_ = 3 Then
        x1 = fminmax(xx1, 0.116617219019459, 0.6851488): x2 = fminmax(xx2, 0.177777777777778, 0.85): x3 = fminmax(xx3, 0, 0.88): x4 = fminmax(xx4, 0.01, 0.954166666666667): x5 = fminmax(xx5, 0.01, 0.6): x6 = fminmax(xx6, 0.2, 1.5): x7 = fminmax(xx7, 0, 1.83333333333333):
        z = anfis_case3(x1, x2, x3, x4, x5, x6, x7)
        z = fminmax(z, 0.350480853596402, 1.20687316557003)
    ElseIf case_ = 4 Then
        x1 = fminmax(xx1, 0.116617219019459, 0.6851488): x2 = fminmax(xx2, 0.177777777777778, 1): x3 = fminmax(xx3, -1.42857142857143, -8.6887835702996E-04): x4 = fminmax(xx4, 0, 1.01): x5 = fminmax(xx5, 0.1, 1.59055118110236): x6 = fminmax(xx6, 0.2, 4.28571428571429): x7 = fminmax(xx7, 0, 1.83333333333333):
        z = anfis_case4(x1, x2, x3, x4, x5, x6, x7)
        z = fminmax(z, 3.78668073195147E-03, 1.74722420826812)
    ElseIf case_ = 5 Then
        x1 = fminmax(xx1, 0, 0.6851488): x2 = fminmax(xx2, 0.177777777777778, 0.85): x3 = fminmax(xx3, -2.04, -0.1): x4 = fminmax(xx4, -1.5, -7.14285714285714E-03): x5 = fminmax(xx5, 8.33333333333334E-03, 0.769230769230769): x6 = fminmax(xx6, 0.2, 2.30769230769231): x7 = fminmax(xx7, 0, 1.83333333333333):
        z = anfis_case5(x1, x2, x3, x4, x5, x6, x7)
        z = fminmax(z, 8.69521112019744E-03, 1.17995552612205)
    End If

    anfis_x_b3_all = z


'overal 12 functions
'coefs=12+40+40+16=108

End Function

Function anfis_case2(x1, x2, x3, x4, x5, x6, x7) '1020010, coefs: 2*2+2*4=12, functions=2

    w2_1 = Exp(-0.5 * (x3 - -3.22304799364604E-02) ^ 2 / 0.201910392163618 ^ 2)
    w2_2 = Exp(-0.5 * (x3 - 0.992762384214297) ^ 2 / 0.30533624531106 ^ 2)
    
    ww1 = w2_1:     ww2 = w2_2
 
    z1 = -4.44835234649191 + 7.34147534328524 * x1 + 6.37103147720343E-02 * x3 + 1.92010022051523 * x6
    z2 = 0.516870704513781 + 0.061172154516305 * x1 + 2.27168549246348E-03 * x3 + 0.178445927494583 * x6

    wwN = ww1 + ww2:     z = z1 * ww1 + z2 * ww2:    z = z / wwN:   anfis_case2 = z
End Function

Function anfis_case3(x1, x2, x3, x4, x5, x6, x7) '1211121, coefs=40
    
    w2_1 = Exp(-0.5 * (x2 - 0.180406862977643) ^ 2 / 0.150409843764262 ^ 2)
    w2_2 = Exp(-0.5 * (x2 - 0.849988368259635) ^ 2 / 0.150022951259308 ^ 2)
    
    w6_1 = Exp(-0.5 * (x6 - 0.200072386216179) ^ 2 / 0.400108803395084 ^ 2)
    w6_2 = Exp(-0.5 * (x6 - 1.50006652728279) ^ 2 / 0.399886475046439 ^ 2)
    
    ww1 = w2_1 * w6_1:    ww2 = w2_2 * w6_1:    ww3 = w2_1 * w6_2:    ww4 = w2_2 * w6_2
        
    z1 = 0.977407468788118 + 0.811721513188389 * x1 + -0.437274314744172 * x2 + -0.441977755493217 * x3 + 0.473808108421339 * x4 + 0.915785863914204 * x5 + -1.50158213848685 * x6 + 0.315200469491991 * x7
    z2 = 2.46608099456399 + -1.83358452751931 * x1 + 1.09613956527633 * x2 + -1.05860615331723 * x3 + 9.95630775400947E-02 * x4 + 1.15816923085654 * x5 + -2.34384094246552 * x6 + -0.835466082818266 * x7
    z3 = -1.50851776626196 + 0.809799544458817 * x1 + 1.76129084797619 * x2 + 4.44169077776385E-02 * x3 + 0.110710454776749 * x4 + 6.62935469994313E-02 * x5 + 1.16219858066652 * x6 + -0.21107046549493 * x7
    z4 = 0.730525922376942 + 4.2454382676685 * x1 + -0.721033518029456 * x2 + 0.22615351152436 * x3 + 0.497943526458622 * x4 + 0.271790014934387 * x5 + -1.55455986518566 * x6 + -0.689878928040032 * x7
    
    wwN = ww1 + ww2 + ww3 + ww4

    z = z1 * ww1 + z2 * ww2 + z3 * ww3 + z4 * ww4:    z = z / wwN:   anfis_case3 = z
End Function

Function anfis_case4(x1, x2, x3, x4, x5, x6, x7) '1111221, coefs=8+4*8=40
 
    w5_1 = Exp(-0.5 * (x5 - 0.101513872310482) ^ 2 / 0.374644833777992 ^ 2)
    w5_2 = Exp(-0.5 * (x5 - 1.64330952968263) ^ 2 / 0.286688793981376 ^ 2)
    
    w6_1 = Exp(-0.5 * (x6 - 0.199987601945582) ^ 2 / 0.999986497083576 ^ 2)
    w6_2 = Exp(-0.5 * (x6 - 4.290087804895) ^ 2 / 0.999679320921736 ^ 2)
    
    ww1 = w5_1 * w6_1:    ww2 = w5_2 * w6_1:    ww3 = w5_1 * w6_2:    ww4 = w5_2 * w6_2

    z1 = 1.23194192612831 + -0.102015820669478 * x1 + 0.735540506003527 * x2 + 0.078856326631852 * x3 + 0.319614205143354 * x4 + 9.83840591051197E-02 * x5 + -0.869935208273097 * x6 + -0.355636259712317 * x7
    z2 = -0.351961991473345 + 0.251829273842367 * x1 + -0.155798762529229 * x2 + 7.01179645554007E-02 * x3 + 0.634668276947576 * x4 + 0.436022660203917 * x5 + -0.352686375625773 * x6 + 2.66908799619188 * x7
    z3 = 6.10581286728616 + -1.17266104068143 * x1 + -4.54326311008577 * x2 + 9.82578509074238 * x3 + 4.9773838853969 * x4 + -4.84850941819557 * x5 + -1.80890086412721 * x6 + 27.3393996659623 * x7
    z4 = 1.29631037935651 + 0.196254444750125 * x1 + 0.644122414306791 * x2 + 0.106966679931971 * x3 + 3.32440580884604E-03 * x4 + -0.103739963031213 * x5 + -0.303319401286831 * x6 + 0.661478657898328 * x7
    
    wwN = ww1 + ww2 + ww3 + ww4:    z = z1 * ww1 + z2 * ww2 + z3 * ww3 + z4 * ww4:    z = z / wwN
    anfis_case4 = z
End Function

Function anfis_case5(x1, x2, x3, x4, x5, x6, x7) '0101121, coefs=4+12=16

    w4_1 = Exp(-0.5 * (x6 - 2.00352276754857E-02) ^ 2 / 0.902587895666764 ^ 2)
    w4_2 = Exp(-0.5 * (x6 - 1.92332835740595) ^ 2 / 1.48914910859546 ^ 2)
    
    ww1 = w4_1:    ww2 = w4_2
    
    z1 = -9.07092542409679E-02 + -0.426973094845581 * x2 + -0.350557685816576 * x4 + -3.47585848366111 * x5 + -1.2431328397951 * x6 + -0.678163860148349 * x7
    z2 = 3.69668537597174 + 1.94070881926916 * x2 + -8.82491435901961E-02 * x4 + 1.26299428202202 * x5 + -2.48542339646986 * x6 + 0.90856781621814 * x7

    wwN = ww1 + ww2:    z = z1 * ww1 + z2 * ww2:    z = z / wwN:     anfis_case5 = z
End Function


